<!DOCTYPE html>
<html lang="en_US">
	<head>
		<title>xthulu node chat</title>
		<style>
			* {
				font-family: Consolas, "Courier New", Courier, monospace;
			}
			.notify {
				display: inline-block;
				padding: 0 0.1em 0 0.1em;
			}
			.user {
				background-color: #00f;
				color: #fff;
			}
			.system {
				background-color: #f00;
				color: #fff;
			}
			.system + .message {
				font-style: italic;
			}
		</style>
	</head>
	<body>
		<ul></ul>
		<script type="module">
			const ul = document.getElementsByTagName("ul")[0];
			const es = new EventSource("/api/user/chat/");
			window.addEventListener("unload", () => es.close());
			es.addEventListener("message", (ev) => {
				if (!ev.data) return;
				const message = JSON.parse(ev.data);
				const li = document.createElement("li");
				li.innerHTML = `
					<span class="notify ${message.user ? "user" : "system"}">
						&lt;${message.user ?? "*"}&gt;
					</span>
					<span class="message">${message.message}</span>
					`;
				ul.appendChild(li);
			});
		</script>
	</body>
</html>
